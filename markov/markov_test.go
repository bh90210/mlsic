package markov

import (
	"testing"
	"time"

	"github.com/bh90210/mlsic"
	"github.com/stretchr/testify/assert"
)

func TestSignal(t *testing.T) {
	want := mlsic.Audio{0, 0.06264832417874369, 0.1250505236945281, 0.18696144082725336, 0.2481378479437379, 0.3083394030591003, 0.3673295940613788, 0.42487666788983836, 0.4807545410165316, 0.5347436876541295, 0.5866320022005455, 0.6362156325320928, 0.6832997808714386, 0.7276994690840092, 0.7692402653962486, 0.8077589696806923, 0.8431042546155973, 0.8751372602002242, 0.9037321392901134, 0.9287765520091285, 0.9501721070958866, 0.9678347484506663, 0.9816950853641806, 0.991698665130853, 0.9978061869755915, 0.9999936564536083, 0.9982524797167027, 0.9925894972756649, 0.9830269571261583, 0.969602427343661, 0.9523686484908523, 0.9313933264172864, 0.9067588662653752, 0.878562048727684, 0.8469136498274179, 0.811938005715857, 0.773772524196507, 0.7325671448950292, 0.688483750195759, 0.6416955292590559, 0.5923862976180484, 0.5407497750278535, 0.48698882440436786, 0.43131465484258347, 0.3739459918455135, 0.31510821802362127, 0.2550324876406651, 0.19395481848461218, 0.13211516463136846, 0.06975647374412641, 0.007123732611892247, -0.055536995323039316, -0.11797953666742966, -0.17995857521140174, -0.24123061569515172, -0.30155494042174913, -0.360694554957803, -0.41841711920665464, -0.4744958601962072, -0.5287104629953566, -0.5808479362589023, -0.6307034490004961, -0.6780811353062289, -0.7227948638273908, -0.7646689690293299, -0.8035389413235665, -0.8392520733718676, -0.8716680600231558, -0.9006595495263083, -0.9261126438533072, -0.9479273461671313, -0.9660179536764467, -0.980313394333687, -0.9907575060537568, -0.9973092573563939, -0.9999429085653609, -0.9986481129311697, -0.9934299572800558, -0.9843089420295122, -0.9713209006488905, -0.9545168588814844, -0.9339628342811638, -0.9097395768511175, -0.8819422518036468, -0.8506800656873403, -0.8160758373504614, -0.7782655154260832, -0.7373976442346158, -0.6936327802020255, -0.6471428610864344, -0.598110530491217, -0.546728420318345, -0.49319839398099236, -0.43773075334857514, -0.3805434125398613, -0.32186104181006747, -0.26191418489530965, -0.20093835328207885, -0.13917310096006763, -0.07686108329331846, -0.014247103707104703, 0.048422848064224006, 0.11090256239000877, 0.1729465770199536, 0.23431114142458126, 0.29475517441090326, 0.3540412112511449, 0.41193633660356666, 0.4682130995602448, 0.5226504072268887, 0.5750343933241125, 0.6251592583977144, 0.672828078337052, 0.7178535780251128, 0.7600588670808599, 0.7992781348033667, 0.8353573015875323, 0.8681546242521778, 0.897541252902392, 0.9234017371383939, 0.9456344796221863, 0.964152135220085, 0.9788819541530245, 0.989766067806515, 0.9967617160773984, 0.9998414153642309, 0.9989930665413147, 0.9942200024921843, 0.9855409750158027, 0.9729900811569104, 0.9566166292499498, 0.9364849452028347}

	sine := Sine{
		Frequency: 440.,
		Duration:  time.Duration(3 * time.Millisecond),
	}

	phase, length, signal := signal(sine.Frequency, .0, sine.DurationInSamples())

	assert.Equal(t, 0.3170068027210882, phase)
	assert.Equal(t, 132, length)
	assert.Equal(t, want, signal)
}

func TestDurationInSamples(t *testing.T) {
	sine := Sine{
		Duration: time.Duration(1000 * time.Millisecond),
	}

	got := sine.DurationInSamples()

	assert.Equal(t, 44000, got)
}
